"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.doVerifyPat = doVerifyPat;
exports.requestPAT = requestPAT;
exports.getPAT = getPAT;
const registry_1 = require("./registry");
const util_1 = require("./util");
const store_1 = require("./store");
async function doVerifyPat(options) {
    const registry = new registry_1.Registry(options);
    const namespace = options.namespace;
    const pat = options.pat;
    const result = await registry.verifyPat(namespace, pat);
    if (result.error) {
        throw new Error(result.error);
    }
    console.log(`\ud83d\ude80  PAT valid to publish at ${namespace}`);
}
async function requestPAT(namespace, options, verify = true) {
    const pat = await (0, util_1.getUserInput)(`Personal Access Token for namespace '${namespace}':`);
    if (verify) {
        await doVerifyPat({ ...options, namespace, pat });
    }
    return pat;
}
async function getPAT(namespace, options, verify = true) {
    if (options?.pat) {
        return options.pat;
    }
    const store = await (0, store_1.openDefaultStore)();
    let pat = store.get(namespace);
    if (pat) {
        return pat;
    }
    pat = await requestPAT(namespace, options, verify);
    await store.add(namespace, pat);
    return pat;
}
//# sourceMappingURL=pat.js.map